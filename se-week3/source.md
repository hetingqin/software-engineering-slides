# 软件工程及体系结构 · 第 3 周

## 敏捷开发 & 质量管理

> 计算机相关专业本科/硕士 | 3+1 学时

---

## 第一讲：敏捷开发到底是想解决什么问题？

### 1. 敏捷开发：价值观与原则

很多人对敏捷开发存在误解，认为：
- 敏捷就是 Scrum、极限编程 (XP)。
- 敏捷就是每天开站立会议、两周一个 Sprint（冲刺/迭代）。
- 敏捷就是用看板软件（如 Jira）管理任务，或者把便签贴到白板上。

**实际上，敏捷不是一种工具或框架，也不是一套具体的过程，而是一套价值观和原则**。各种框架和工具是“术”（手段），敏捷本身是“道”（指导决策的思想）。

### 2. 敏捷软件开发宣言

![敏捷软件开发宣言](../assets/d5f757c6b60a51dfe3dab3bde8a736ea.png)

2001 年 17 位轻量级软件开发流派领军人物确立了四大核心价值观：
1. **个体和互动** 高于 流程和工具
2. **工作的软件** 高于 详尽的文档
3. **客户合作** 高于 合同谈判
4. **响应变化** 高于 遵循计划

*注：宣言右边的内容正是传统重型瀑布模型的核心。敏捷并未否定右侧的价值，但更看重左侧。*

### 3. 用敏捷的方式“盖房子”（案例比喻）

敏捷正是为了解决瀑布模型中**周期长、发布烦、变更难**的问题。如果用敏捷方式盖房子：
- **需求**：变成了“作为上班族，我想要一个卧室来休息”（用用户故事代替繁难需求文档）。
- **Sprint 1**：搭了个草棚（最简可用，客户能入住体验）。
- **Sprint 2**：升级成简易厨房，修复屋顶漏水的 Bug。
- **Sprint 3**：升级成小木屋，但可能由于自动化测试不完备忘了加窗户。
- **Sprint 4**：修好窗户，完成砖瓦房。此时客户发现一家三口空间不够，决定下个迭代扩建为 3 居室（拥抱变化，不抵制需求变更）。
- **最终**：在不断的短周期迭代和修补中交付。不再等到测试阶段才发布，客户随时能看到可用版本。

### 4. 瀑布模型与敏捷开发的具体差异

| 实施环节 | 瀑布模型 | 敏捷开发 |
|----------|----------|----------|
| **需求分析** | 产出详尽的需求文档，需求冻结 | 使用“用户故事”（写在一句话卡片上），边开发边当面沟通细节 |
| **架构设计** | 开发前完成完整系统设计 | 渐进式架构设计，只做适合当前需求的架构，需定期重构（偿还技术债） |
| **质量保证** | 专门的测试阶段集中测试保障质量 | 开发阶段依赖编写代码的员工顺手写自动化单元/集成测试，前期可能不稳定（类似 Windows 10） |
| **发布部署** | 集中测试通过后手工部署到生产 | 持续集成与持续发布（CI/CD），代码一交就自动构建和部署 |
| **迭代节奏** | 即使是普通的迭代模型，每个大迭代（如小瀑布）前期很轻松，后期测试阶段可能很紧张 | 一个个循环的 Sprint，节奏恒定，产品版本稳定。做不完的故事不影响发布 |

### 5. 我们该不该选择敏捷开发？

实施敏捷开发需要满足以下条件（否则形同虚设）：
1. **团队要小**：人数超过规模就要分拆。
2. **紧密协作**：团队内部协作透明，客户深度配合。
3. **扁平化结构**：领导支持，更少控制，给项目成员主动性。
4. **工程基础**：写代码要有自动化测试比例，搭建好源码管理和 CI 环境。

> **软件开发最核心的是人，而不是用什么方法**。如果不具备全面敏捷的条件，可以先借鉴持续集成、每日站会等好实践。

---

## 第二讲：大厂都在用哪些敏捷方法？（上篇：核心流程）

### 1. 分而治之的大厂策略

大厂开发项目的核心思想是工程中常用的“分而治之”：**大项目拆成小项目，大服务拆成微服务，大团队拆成小团队。** 
底层依赖微服务、容器等新技术提供隔离，团队依赖标准协议通信配合。只要组织扁平，工程师地位够高，大企业也能真正敏捷起来。

### 2. 一切工作围绕 Ticket（看板）开展

早些年墙上贴的是甘特图，现在大厂日常一切围绕看板工具（如 Jira、禅道）。
- 所有的工作——不管是报 Bug、提需求，还是重构代码——都必须发起一个 **Ticket**。
- 看板分为 **To Do（待选取）、In Progress（进行中）、Done（已完成）** 栏。
- 每天上班第一件事，就是根据看板直观掌握 Sprint 的进度。员工自己认领任务，项目经理可通过看板积压情况及时介入发现风险。

![看板示例](../assets/33752b50f5363233581263e882e19aa9.jpg)
![Jira 看板实例](../assets/963f6a02614892e09ef936ac54dc8178.png)

### 3. 基于 Git 和 CI 的自动化交付与部署流程

为了解决瀑布模型中“代码不稳定”（必须设代码冻结期）和“部署太麻烦”（靠专人手工改配置发布）的两大痛楚，大厂采用了分支与持续集成：

- **代码准入与审查（Code Review）**
  - 不再直接提交到主干（master），而是开分支（branch）开发任务。
  - 完成后提交合并请求（Pull Request / PR），要求同行检视代码变更并给出评价。
- **持续集成（CI）工具**
  - CI 是一个不知疲倦的机器人，PR 提交后，CI 自动下载代码、安装依赖、检查代码格式、运行所有的单元测试和集成测试。
  - PR 能合并进主干的前提：**CI 测试全绿 + 代码 Review 同意**。
- **一键自动化发布**
  - 合并后，CI 会自动构建出 Docker Image 并发版到开发环境或测试环境。全程通过监控和报警兜底，无需人工等待数周去部署。

![持续交付流程图](../assets/be26482df2715220b0dc2f90f034bd12.jpg)

### 4. 每日站立会议（Daily Standup）

不是汇报会，而是聚焦团队沟通，每天控制在半小时以内（通常 15 分钟），即使不站着开也行，重在高效沟通反馈。由 Scrum Master 或轮班主持：
1. **成员轮流发言**：昨天干了什么？今天计划做什么？遇到什么障碍无法推进？
2. **检查最新 Ticket**：梳理新提单的 Bug 和需求，甄别优先级，决定放入当前 Sprint 还是未来任务积压清单 (Backlog)。
3. **问题停车场（Parking Lot）**：会上遇到复杂讨论（比如发散到讨论团建问题）要立刻打断，将问题停到“停车场”，会议结束后单独跟进解决。

---

## 第三讲：大厂敏捷方法（下篇：一个 7 人小组的日常实战）

### 1. 敏捷团队的标准配置与分工

大厂里维护某核心业务微服务的一个典型敏捷小组配置：约 7 人。
- **产品经理 (Product Owner)**：写需求文档，转化成 Ticket。
- **开发人员 (约 4 人，含架构师)**：每天从看板 To Do 栏按高优先级领 Ticket。
- **测试人员 (1 人)**：测试环境里跑代码，找 Bug 并报 Ticket。
- **项目经理 (Scrum Master)**：服务型角色，保障流程顺畅并扫除障碍。
*小结：每天只围绕极短的 1 周一个 Sprint 进行冲刺。*

### 2. 小型敏捷团队的一周核心节奏

- **上半周：部署生产环境**
  - 没有人愿意星期五发版并在周末心惊胆战。所以即使上周代码早测好了，生产发布也都放在上半周（如周一/周二），出事有足够时间应对并随时回滚。
- **每周二清晨：迭代回顾会议（Sprint Retrospective）**
  - 常规站会结束后开一小时。**核心议题**：复盘上个 Sprint 哪里做的好，哪里差。
  - **实战案例**：测试反馈开发总在发版前改代码导致重测，团队表决决议后，定下规矩：非紧急情况不得在预部署分支更新。
- **每周四清晨：迭代规划会（Sprint Planning Meeting）与“估算扑克”**
  - **评估工作量方式**：所有人对每行 Ticket 进行脑海评估（1分为1天完工，5分为极难），然后大家一起倒数 3、2、1 同时亮出手势（或用估算扑克）。
  - **好处**：避免唯项目经理估算是从，要求全员熟悉需求架构，最高分与最低分须出面碰撞讲解，带动新手小白学习老手的评估经验。
- **每周五下午：分支切割（Branch Cut）**
  - 一周开发结束，为了能让 QA 进行验收测试。要在周五下班前（比如下午 4 点）把主干代码克隆出一条预发布分支。
  - 主干继续走新需求开发，测试分支只用于专门修 Bug、验收测。通过了才考虑上线。

![测试多环境与分支切割](../assets/30f2a81130d5adc74921c88a0f7464c5.png)
![Branch Cut 分支切割](../assets/a1ff4dc93ffa7d68ab5d757317623167.png)

### 3. 解答关于敏捷实战的经典疑问

- **怎么保证一周交付 1 个版本的质量不崩塌？**
  - **三道防线**：(a) 极高比例的自动化测试覆盖；(b) 极短的 Sprint 测试流转（新 Sprint 开始后，测试有整整一周时间在刚 Cut 出来的测试环境里慢慢测）；(c) 紧急时刻团队“全员测试”。由于每周变更极小，出 Bug 很容易查到是谁写的。
- **基于敏捷怎么做整年计划？**
  - 大厂年底由各部门确定下财年宏观目标。任务分发后，落到小组层面，其实只是简单计算当前 Sprint 能装进多少分数的 Ticket。只要不跨越时间窗口即可。
- **这案例算不算“标准”敏捷（Scrum）？**
  - 角色称呼不同，站会还带检查 Ticket，并且直接让 PM 撰写需求文档而没用单纯的“用户故事”。
  - **答案是肯定的，依然是敏捷**。因为**敏捷是价值观的贯彻**，而不是教条。只要遵循价值观并保持效率提高沟通，就是好的敏捷。此外，很多组会有“**每周轮值**”来培养跨角色认同和集体责任感。

---

## 第四讲：如何平衡质量与时间、成本、范围？（质量金三角）

### 1. 软件项目管理金三角法则

现实工程就像挑选对象，“多、快、好、省”不能全占，最多占两样。软件工程也适用一个定律：

![要好、要便宜、要快的韦恩图](../assets/f5bb522b7fd25d6d7738642e4c922ccf.jpg)
![项目管理金三角](../assets/7fa5c8351b4590a2bc8a482955c133f7.jpg)

- **三条边**：时间、成本、范围（功能）
- **中间居首**：**质量**（软件工程核心：开发并维护高质量软件，绝不妥协）。
- **硬核法则**：如果想保持质量不动，当其中一条发生变化（比如时间压缩），另外一条或两条边**必须做出改变平衡**（增加外包成本，或砍掉大半功能）。否则被挤压崩塌的必定是中心的“系统质量”。

### 2. 实战技巧：应对各种扯皮场景

- **场景 A：老板要“压缩时间”（3 个月的活 1 个月必须上线）**
  - 传统思路：硬怼，失败，然后疯狂加班，最终产出烂项目。
  - 金三角思路：时间受制。同意 1 个月上线，但提条件：“由于时间少了，版本只能出**缩小范围的核心先手版**”，或“你需要给我**增加更多 HC 名额预算（成本开支）**”。用多选一让老板来定。
- **场景 B：产品经理“中途强行塞需求”**
  - 范围（体量）变大。应对方式：坦然接受，给两条出路：“要么原本谈拢的上线日**延期交付**，要么申请预算**增加开发人手**”。

### 3. 瀑布 vs 敏捷在金三角上的根本分歧

![瀑布 vs 敏捷对金三角的不同策略](../assets/27e916733d013fa85b2964a2b1051ea0.jpg)

- **传统瀑布路线**：**固定范围边**。为了把庞大的合同功能全做完，一旦出现变故，老板绝不妥协功能，结果只能是“时间和成本大幅超标（无尽加班延期）”。
- **极端敏捷路线**：**固定时间与成本边**。时间（比如 2 周的 Sprint）是铁打不动的，人力成本是不变的。既然这两边固定不变了，想保障质量，**只能变成动态裁剪范围**。谁优先级高（如高优 Ticket）做哪个，边缘需求留到猴年马月去。
  - *这解释了为什么敏捷开发加班稍微少些，且不会发生无穷尽的整体大拖欠*。

![瀑布vs敏捷金三角详细对比](../assets/1yy45e28893d0b4652e780d47f0a2873.jpg)

### 4. 经典商业案例：金三角的极致运用

- **淘宝网 1 个月上线传奇（增加成本保时间和范围）**
  - 2003 年，马总要求 1 个月上线淘宝网，时间定死，网站范围不能缩水！
  - 团队解法：加巨量成本。直接高溢价去外边收购拿来一套包含购物、交易的成型系统代码，让牛人直接改版。成功抓住“非典”红利腾飞。
  - 同理，如果技术团队今天为了做代码合规而费尽力气去搭建私有服务器和代码库系统，不如直接**购买商业级的 Github企业版**，舍成本，赚时间和质量。
- **MVP（最小化可行产品）的精髓出处（缩减范围保质量）**
  - 想快，想省钱，还想成功。怎么破局？只有“**无情地砍向范围**”。
  - 摒弃大而全的执念。把核心骨干提炼成 MVP 让客户验证反馈后再增加功能。如果不懂金三角，就只会什么都想做，终究在延期中死掉。程序员要主动学习“砍需求”的技能以确保项目安全。

---

## 第五讲：为什么普遍不重视可行性分析？

在大多数软件工程教材里，“可行性研究”位于第1章核心位置，也是考试必考。分为三大基本维度（一般扩充为四个）：
1. **经济可行性**：长短期营收与开支平衡分析。
2. **技术可行性**：团队当前能力储备能否破界，是否存不兼容硬件/协议黑洞。
3. **社会可行性**：是否触碰法律法规、核心版权及重大负面伦理风险。

然而现实开发却常常忽略这一“救命稻草”，人们给出的“不靠谱”托辞通常包括：

- **托辞 1：“我们是软件行业，一开始需求就很抽象模糊，做个锤子分析？”**
  - 真相：如果真模糊，你大可以等需求随着立项拨云见日后马上补做，一旦苗头不对当机立断止损。不能成为不做分析的理由。
- **托辞 2：“老板或者产品大大强行拍板，就算不可行你也得蒙头写代码！”**
  - 真相：若你人微言轻，必须拿出一份客观全面“专业评估”免责防反噬；而如果你是老板，若不培养这种风险理智习惯是在自断江山（除非你是像马云当初拍板王坚硬做阿里云那种看到了时代长远战略红利的特例，别人看不穿你可行性布局里的真意）。
- **托辞 3：“我们是在搞试错和互联网创新，搞那么多繁文缛节分析，还要不要造轮子拿融资了？”**
  - 真相：毫无根据的可笑言论。可行性分析是用来前置过滤无效轮子保命的底层逻辑雷达。如果你用违法的开源协议去做再多创新，最终依然只能竹篮打水。

### 惊心动魄的案例还原：React Native 跨平台“大迁徙”惨案

用一次完整的软件分析手段来解剖曾发生在国内一线互联网部门的真实事故。项目初衷为全面迁徙移动端框架（节约 Android / iOS 脱节人力）。

**A 面：经济可行性调研**
- **开支明细估算**：10 人先发小组奋战半年，人力开销 ¥600,000，设备硬开销 ¥60,000，挤占停发其它项目的成本影响 ¥1,000,000，全部开出耗成本约 **¥1,660,000 /半年**。
- **潜在回馈估算**：统一底座后每年能提效多出2个大型项目、全部分摊省下巨量隐形成本，一年回撤反哺创收 **¥2,600,000 级**。
- **分析宣告**：不到 10 个月即可拿回本金盈利，**从经济账面看，天长地久，稳妥可行！**

![经济可行性分析实例](../assets/ffcf64bafc95994c75db0b26e91179e9.png)

**B 面：技术可行性调研**
- **人才面**：团队中本有 5 名大将熟知 React Native 的大底子，外带拉一批小白 3 个月培训出栈，兵马管够。
- **技术坑位分析**：个别超级老旧的边角料安卓机水土不服白白丢失响应（忽略不计），原生视频流核心插件没底子（放技术冲锋计划，评估可以死磕下来）。
- **分析宣告**：天下武功唯快不破，**技术没有生死死穴，安全可行！**

**残酷的 C 面：社会（法律）可行性底线穿透**
- 大厂的法务天团在临上线进行代码基座封口溯源盘点时，惊恐的发现一个开源恶魔雷区！
- **Facebook“BSD + 专利”霸王条款大曝光**：React Native 使用的并不是纯善的公益开源协议，而是一种捆绑契约。只要大厂因为任何非相关的底层纠纷和扎克伯格名下的商业版图产生“专利法律起诉与防卫”。按照霸王协议判定：该厂的所有 RN 代码体系连坐，立刻丧失合法授权（会被美国法院掐喉）。
- **悲剧谢幕**：此时整个大厂部门耗费大半年开发的成吨源码只能全部推翻、销毁，眼睁睁看着百万战损血流成河。如果在立项日先让懂王拉起社会法务尽职调查的可行性防护网，便能提前选择那些签署友善的 MIT 协议去开发组件。

> **为技术人送上最后一局忠言**：
> 不要把可行性报告看作给上面交差的形式文档。把它应用在你买房租房跳槽涨薪博弈的方方面面。如果要重做系统优化，先看时间投入与最终 20ms 首屏加速值不值（经济）。如果你跳槽多拿了一万时薪却被告赔了违约金（社会竞业协议未调查可行度）。
> **要是研究也给不了你十足的把握？立刻去投石问路做个“最小化试点产品 MVP”验证完毕再铺重兵。不看天气预报直接出水手，注定有去无回。**

---

## 阶段作业与下周预告

📋 **课后思考题（邹欣老师《构建之法》名局拷问）**

顾客都是贪心的，总是既希望“光速上线（快）”、又要“一毛不拔（人工便宜廉价）”、同时要求“系统零 Bug（质量巨好全全须全尾）”，更甚至希望“天下白食（完全免费）”。身为项目掌门人，如果你**迫于无奈只能满足它的不同片段**，系统将会结出怎样的果实？

1. 如果你向“**又快（急速赶工）、又廉价零成本**”的条件低头，请问你抛出了一个什么样的系统怪胎？
2. 如果满足顾客要求“**该软件免费，且还要尽快送达越快越好**”，在没有资金也没有耐性的土壤里，这团软件会滋生出何种特质？
*(请尝试利用今天学习的项目管理金三角和底线法则，同你组建的新小组做破冰推演脑暴)*

![作业配图](../assets/2805340682c1b5068a744c6f9414b98c.jpg)

🔭 **下周预告：项目实操规划与控制网**
我们将带这套理论下放底层：WBS 动作拆解连招 → 时间与排版计划书 → 开发底座行为规范 → 高效作战例会的终极形式 → 管理套件打法 → 死地求生的避坑风险图卷。

