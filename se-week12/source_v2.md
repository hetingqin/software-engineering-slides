# 软件工程及体系结构 · 第 12 次

## 软件工程及体系结构

### **行业案例：从失败教训到顶级开源与大厂实践**

> 电子信息工程专业硕士 | 3 学时
> 主讲人 | 何庭钦 | 271880026@qq.com

---

## 第一讲：满目疮痍——盘点那些失败的软件项目

### 1. 怎样才算一个失败的项目？

项目管理协会（PMI）定义的成功项目需同时满足 6 个条件（反之则有可能失败）：
1. 按时交付
2. 成本在预算内
3. 按照当初设计正常运行（Bug 率可接受）
4. 有人使用（市场认可）
5. 满足最初设定的业务目标
6. 出资方满意

*注：近十年重大失败软件项目的损失高达 700 亿美元级别。*

### 2. 空难调查逻辑：从四大维度解剖失败根源

航空业调查坠机不会只看飞行员，同理，软件项目失败必须多维度排查：

*   **外部环境**：不切实际的政治/商业节点倒逼；需求反复变更；预算被恶意压缩。
*   **技术管理**：引入完全无法驾驭的不成熟技术；项目规模复杂度远超团队技术承载力。
*   **项目管理**："外行领导内行"的瞎指挥；资源分配错误；没有风险应对 Plan B（B计划）。
*   **组织文化**：捂盖子文化；指出问题的人被开除；只顾推诿扯皮，无人对结果负责。

### 3. 三大史诗级失败案例

**案例一：法国政府某政务项目（来自地狱的项目）**
*   **经过**：计划 2-3 年，干了 12 年未上线，600 万行 C++ 屎山代码。负责人因欺诈入狱。
*   **死因**：经理 35 人，开发才 20 人。每天只开会改 PPT；无版本控制协作。

**案例二：美国 FBI 虚拟案件文档系统**
*   **经过**：花费 1.7 亿美元，历时 4 年，最终在一行未用的情况下宣布彻底废弃重构。
*   **死因**：复杂性失控（无法满足现实场景）；提出问题警告的员工被强制开除；上线前完全没做测试。

**案例三：微软 Windows Vista（目标崩盘）**
*   **经过**：比尔盖茨定的三大激进技术目标（全 C#、WinFS 数据库文件系统、Avalon 渲染界限）。开发 3 年后发现全线崩盘，全部推翻重来。
*   **死因**：为商业竞争设定技术盲目脱离现实目标；核心团队明知不可为却不敢向上管理反对；项目周期太长。

**得到的启示**：尽早做MVP和敏捷的小步快跑（早点死或早点调整）；严控技术选型；扁平包容的团队沟通文化。

---

## 第二讲：开源标杆——VS Code 的卓越工程实践

### 1. VS Code 开发团队概况

微软旗下的 VS Code 是一个拥有无与伦比工程质量的免费编辑器项目，团队常年维持在约 **20 人**的超精简扁平结构规模，每月按时发布一个更新极多的 Release 稳定版本。它如何做到？

### 2. 极其严苛的 4 周节奏（快速迭代）

VS Code 采用每四周作为一个迭代的铁律：

*   **第 1 周（技术债与计划周）**：清理上个版本积压的严重 Bug；专门留出时间**偿还技术债务（重构与优化性能）**；规划本期新 Feature。
*   **第 2、3 周（集中开发周）**：所有人按里程碑与 GitHub Issue 分工，闭关编写新特性与修复日常 Bug。每天要查收优先分配给自己的紧急漏洞。
*   **第 4 周（Endgame 测试周）**：停止开发新功能（Code Freeze）。本周**只做测试与 Bug 修复**，并撰写向外发布的更新日志。
*   **下月第 1 周的周三**：准时发布上个周期的正式稳定版本。

### 3. 没有专职测试，怎么保质量？

与传统认知不同，VS Code 全员开发，**没有一个专职 QA（测试人员）**。通过**制度设计**解决：

*   **轮岗制 - Inbox Tracker（清道夫）**：
    *   每天面对社区几百条新 Issue 提交。
    *   机器人 `VSCodeBot` 会先做一遍初步清洗。Tracker 做人工二次过滤，鉴别是提问还是真 Bug，打标签分发。
*   **轮岗制 - Endgame Master（测试指挥官）**：
    *   制定第四周测试的详细 Check List（清单）。
    *   **交叉测试原则**：程序员不能测自己的代码，将任务强制作业指派给其他组员。并每天群发测试进度。
*   **全维度的自动化测试网**：
    *   提交代码到 Azure Pipeline，立刻触发云端跑单元测试（几千个用例，1分钟）和集成测试（3分钟）。覆盖 Win/Mac/Linux 跨三个操作系统的兼容性验证。
*   **"吃自己的狗粮"（Dogfooding）**：
    *   每天构建出一个绿色的内部开发测试包（Insider），VS Code 团队必须强制用昨天打出来的包含新 Bug 的绿色包写今天的代码，痛点自知。
*   **庞大的"小白鼠"预发布**：发布前先推给 2 万名微软内部员工当灰度小白鼠度过 24 小时高危期。

---

## 第三讲：大厂规律——科技巨头们的软件工程共性

其实各大厂的企业文化大相径庭（Google 极高标准精雕细琢还爱重写，Facebook 信奉 "Move fast and break things" 野蛮生长）。但抛开文化，现代大型科技企业在工程实施上存在大量**共性趋势**。

### 1. 团队与职责的进化

*   **绝对的小团队（Two-Pizza Team）**：为遏制指数级爆炸的沟通成本，业务哪怕再大，核心组件也会拆分给 10 人以下团队维护（如 YouTube 的单一导航栏）。
*   **手工专职测试的消亡**：不仅 VS Code，微软、谷歌、阿里等越来越多产线取消了专职的手工测试岗，转而由**开发承担测试代码的编写**+强大的工程自动化巡检+精准的线上灰度监控替代"点点点"。
*   **DevOps 深水区**：开发（Dev）和运维（Ops）不再是对抗背锅关系。写代码的人也要负责把代码发上线并盯盘。

### 2. 不容讨价还价的开发铁律

很多中小团队觉得麻烦的流程，在大厂是**强制红线**：
1.  **必须开分支开发**，严禁直推主干。
2.  **代码合并前必须经过 Code Review（代码审查）**。甚至出现过 Google 厕所隔间里贴《Testing on the Toilet》海报普及测试用例写法的文化。
3.  **不写测试代码的提交直接被打回**，主干必须时刻保持所有的红绿灯用例 100% 测试通过。

### 3. 极速迭代与多通道发布体系

过去软件三年憋一个大招的时代落幕，哪怕是最庞杂的 Chrome 浏览器或 Windows 10，都在执行高频迭代策略。

**以 Chrome 四大发布通道为例：**
1.  **Canary（金丝雀版）**：每天编译发布。极不稳定，用于给极客用户趟雷试毒。
2.  **Dev（开发版）**：带新功能的抢先后台验证版本。
3.  **Beta（测试版）**：面向爱好者的较稳定公测版，提前吃螃蟹。
4.  **Stable（正式稳定版）**：千锤百炼后，全量推送给几亿普通大众的保险版。

通过**圈层灰度（1%→5%→50%→100%）**、线上遥测预警和"一旦发错即可一键关闭 Feature Flag 或回滚"的底气，实现了"没有测试员也能安全狂飙"的现代大厂工程奇迹。

---

## 课后研讨任务

📋 **综合演练：从失败灾难到大师级流程的推演**

**第一题（灾难救援）：**
请任意选择本文中提到的三个失败案例（法国政务、FBI文档、Vista）之一。假设现在时间倒流回到该项目启动的第一天，如果你被直接任命为 **总架构师兼项目经理**，你将如何运用我们已全学过的《软件工程之美》相关知识点（含计划、需求、敏捷、技术选型等），下达并执行 **拯救该项目的三大核心战略指令**？

**第二题（制度移植）：**
阅读完 VS Code 团队无专职测试人员却能保证超高系统质量的战法。你目前的学校团队全员也都是程序员没有专门做测试的同学。
如果要在你们的毕业设计或实验项目中**完整照抄 VS Code 的这套理念**，
请分条列举出你需要搭建哪些机器流水线（工具名即可）？需要团队每小组成员签下哪些带有惩罚性质的规范承诺？ 
