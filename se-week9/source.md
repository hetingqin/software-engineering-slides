# 软件工程及体系结构 · 第 9 周

## 质量防线与协同基盘：自动化测试与极客源代码管理

> 计算机相关专业本科/硕士 | 3 学时

---

## 第一讲：绞杀 Bug 于摇篮——自动化测试

为什么有的团队敢在一晚上重构三千行核心代码然后平稳入睡？而有的团队改一个微小的样式，第二天全站崩溃导致老板疯狂打电话？
**差别只在于：你有没有在系统里布满无数的“自动化探雷器”（自动化测试代码）。**

### 1. 人工测试的局限与自动化的降维打击
人工点按屏幕测试，不仅又慢又容易遗漏，而且每次全量回归测试可能要耗费几天甚至几周时间。
- 而自动化测试，是**程序员写出另一套代码，用来测试业务代码**。
- 它可以用极端的暴力手法，在 5 分钟内模拟点击、调用系统函数 **1万次**！
- **最恐怖的优势：** 每次你向主库提交更新时，后台机器人可以瞬间雷达般扫描全站，一旦你写的代码悄悄引爆了其他模块的旧 Bug，警报立马拉毁制止你合库！

---

## 第二讲：重兵布阵——Google 的测试金字塔与分类战

不要瞎写测试！自动化测试需要严格的排兵布阵体系：

### 1. 小型测试（单元测试单元格）
**执行极快（几微秒）、没有外部依赖的纯粹函数级别的微观体检。**
- 比如你写了一个发钱的接口。单元测试就是直接虚拟造出 1A 参数传进这个类里，看看返回的数据对不对。
- **强制要求：** 不准连真实的网、不准连真实数据库（全部用 Mock 假接口代替）！只在此函数内完成死磕闭环。
- 这是金字塔**最庞大的底座**，因为它是成本最低的收益之源。

### 2. 中型测试（集成测试组件块）
**验证两个或以上模块接壤的地方会不会出现断裂。**
- 此时你可以连真实的本机内部数据库了，比如测一测“发钱接口能不能真实把数据落入这台测试机的数据表里”。
- 但为了保证流水线跑得足够快，必须要求此测试在“单机离线拔网线”的情况下也能顺利跑通。

### 3. 大型测试（端到端系统测试 / E2E）
**最笨重、最真实的全链路战争演习。**
- 直接连接公网、连接外网真实的支付网关、打开真实的 Chrome 无头浏览器去模拟用户输入账户密码点击！
- 因为最难写、经常因为网络波动而报假故障，所以只安排**极少数目的主干道场景**进行覆盖。

![测试金字塔结构图](../../assets/616bb4cdb13884dde562b10568ba77cf.png)

---

## 第三讲：纪元破晓：打赢多人协作火拼的战争底盘

几千人同时在一座名为系统的大厦上施工，最怕的是什么？**他拆了你的承重墙，你剪断了他的高压电缆。**

### 1. Git 与分布式管理工具：神明视角的后悔药
- **1970年原始人阶段**：大家只能靠U盘互拷覆盖，连谁删了谁的文件也不知道。
- **2000年集中营式开发（SVN）**：必须要连上中央主机才能合并，一旦服务器断网停电，全公司程序员只能发呆放假。如果机房着火，所有历史记录将瞬间灰飞烟灭！
- **现代降维杀器（Git 与 GitHub/GitLab）**：每一个开发者的笔记本电脑里，都藏有一个极度完整的“完整项目克隆核”。即便主楼服务器被人炸了断网，你依然可以在防空洞离线提交任何一分秒的历史快照，并在重新联网那刻实施超维合并！

![分布式版本管理图注](../../assets/603379637ba76d67ddcc21f1d515b202.png)

### 2. 让几千人不互相践踏的三大法则：
1. **像强迫症一样频繁切割提交！** 不要埋头造半个月憋个大招再合并。那等于让几万行未知隐患互相剧烈相撞。大厂高手的操作：每天提交三次！颗粒度越小，出事了回滚越精准。
2. **每次提交，后台机器必须无情扫射测试：** 利用 CI/CD 的集成雷达，你的烂代码如果不通过上方的中小型雷网，绝不让你接入总管。
3. **生死簿双盲审查规则（Code Review）：** 没有人审查过的代码，不配上线。找茬和被找茬，是一场技术晋升的最高修行。

---

## 第四讲：工业界的标准军规——GitHub Flow 流程

怎么玩转 Git？目前最受顶级大厂推崇的基础大派系：

> **“主干（Master）永远是清白且可以直接拿去发布售卖的！”**

![GitHub Flow 演示卡](../../assets/1a665275ab20b3fd3a7711db357271d6.png)

1. **绝对禁令区：** 任何人，哪怕是 CTO，也不准直接在 Master（或者 Main）分支上手敲代码修改！
2. **开辟练兵结界（创建 Branch）：** 如果你要加一个抽奖新功能，首要任务是从干净的 Master 上分叉出你专属的 `feature-lottery`。
3. **申请并入神坛（Pull Request）：** 当你在你的小房间造好了轮子，发起一个合并公投表单。
4. **残酷公审大厅（讨论与 Code Review）：** 高玩和门卫在这个表单底下对你的代码痛骂或点赞，指出不合规范的脏函数。同时后台 CI 机器人开始暴力打压测试你的这几行新码。
5. **入魂并合（Merge）：** 只有等人工与机器**全绿灯验收**。才能正式将你的成果融入无垠的纯净星海的 Master 中枢上！并随时等待发布轰炸！

---

## 阶段反思沙盘作业

📋 **高危决策：修罗场与合并海啸**

场景一：你们的小组刚刚结束半个多月的异地开发封禁期，大家正准备在产品上线死线前一天晚上集体合并十多个人积压在电脑里各四五万行的代码。可想而知那将会是怎样一场血腥暴动的巨型合并灾难！
**实战决战：**
为了防止下月再度爆出这种全剧重创式事故，你要如何在接下来的周会上强制推行基于 GitHub Flow 与持续集成的开发纪律化白皮书？请列出惩罚与防退化规范三条死令！
