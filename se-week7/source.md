# 软件工程及体系结构 · 第 7 周

## 核心开发技能与持续交付：填平雷区，打造流水线

> 计算机相关专业本科/硕士 | 3 学时

---

## 第一讲：技术债务——你欠下的每一行烂代码，都在收利息

项目极度赶进度，老板发飙说“这功能明晚必须上！测试代码以后再补！”、“那个旧接口就不重构了，你直接 copy 一份改改用！”
——这些为了**走捷径**而写下的垃圾代码和劣质架构，就叫**技术债务**。

### 1. 欠债的利息与恶性循环
代码烂，导致你想加一个新功能时，找不到地方插进去，插进去又牵连了无数 BUG。原本一天干完的活，现在排雷要花三天！这多出来的两天时间，就是**债务的超级复利**。

### 2. 债务象限：你是哪种老赖？
![技术债务四象限](../../assets/9ee240f45ed039399819232419bb3088.png)
- **轻率 / 无意（最致命）：** 连什么是架构都不懂，胡乱写码。这种老赖迟早身败名裂（服务器彻底停摆）。
- **谨慎 / 有意（良性负债）：** 为了争抢国庆档市场先发制人，“战略性欠债”，事后迅速拿钱砸回来进行代码重构。

### 3. 三大还款策略：
1. **老赖推翻重写：** 旧系统烂到家了，找个开源 CMS 把数据全导过去，不伺候了！
2. **底层穷鬼修补：** 只要不死机就不碰核心，烂的地方缝缝补补。
3. **分期付款重构：** 在业务运转期间，每周趁月黑风高偷偷替换掉一部分烂底层模块。

![图：重构交叉点](../../assets/7951ea8fb6d669260055ab07c624fb16.png)
> 设计与速度的临界点：越烂的代码后期阻力越大。

---

## 第二讲：程序员的修炼心法——效率暴翻的终极守则

很多人抱怨项目烂、产品经理脑残、“996 是福报”。如何打破这种低效泥潭？

### 1. 扩大影响圈，拒绝受害妄想症
- 老天要下雨（你改变不了），但你应该出门带伞。
- 产品经理需求写的一团乱。你不要当木偶被动开喷，而是在接活的第一时间夺过本子，拿着极端异常情况狂怼产品进行闭环！

### 2. 以终为始
拿到需求不要立刻打键盘敲代码，敲出五千行发现逻辑断裂。
先画架构图！先定出终点界碑。**先写单元测试**（先想后果），再写实现动作！

### 3. 撕碎四象限，要事置顶
生产数据库被击穿断联了，这叫**重要且极度紧急**。
重写烂底层框架防暴雷，这叫**重要但不紧急**。但如果你不做，下个月它就会爆炸。
全屏屏蔽聊天软件，一刀切掉那些占用你的**紧急但毫无卵用**的事！

---

## 第三讲：CI/CD 护体——像造汽车一样部署代码

以前部署一次就是灾难！开发人员熬个通宵，对着文档修改生产线环境配置文件，改错一个标点符号早上六点全国用户打不开网站。

### 1. 持续集成 (Continuous Integration, CI)
> “这事令人痛苦，这事我们就更频繁地去做！”

别三个月大家才代码大合并合并出五万个冲突。
**每天甚至每小时合并一次代码！**
一旦上交仓库，无头服务器机器人自动拉取，进行千项单元暴力连测！只要红灯报警一次，立刻打回去重做！
![持续集成流水线](../../assets/8de10a3d3b2e46e2f8b945bdf4d37fbf.png)

### 2. 持续交付 (Continuous Delivery, CD)
连编译打包生成正式镜像发布到测试预览服务器，都是自动流串在一起的。部署测试服务器只需要一键流媒体操作。

### 3. 最强境界：持续部署 (Continuous Deployment)
![持续部署流水线](../../assets/a2e354c88a3bf0df871174980ef3a900.png)
所有通过自动化连环暴虐测试的包，连人工老总点头批准都不需要了。**没有任何人为拦截！立刻滚热发布到了全体真实用户的终端机上！**
（这必须要极度变态的 90% 以上测试覆盖率，并在代码里绑上随时可撤回的**开关炸弹 Feature flag**）

---

## 阶段作业与沙盘决断

📋 **高危决策：代码修罗场中的抉择**

场景：你们小组正在接管前朝同事留下来的一座“屎山项目”，里面没有任何测试代码。\n距离新国庆促销版本上线还有1周黄金时间。老板要求必须把一个巨大的砍价活动插进屎山里。
**实战决战：** 
1. **[还债赌局]** 这个砍价活动如果在旧底座上硬加，只花 3 天写满 `if else` 即可完成，但一定会制造严重的数据污染。如果要顺带重构支付模块，需要花 6 天时间（剩一天测压），极其危险。\n你在这种绝境下，会选择“故意欠债”还是“分期还债”战略？
2. **[CI/CD 流水战]** 这群老派程序员每天还在手工把包发给测试组。身为领头的技术总监，你如何通过几刀斩乱麻的规矩动作，在一周内强制推行“持续集成（CI）”去斩断人为编译报错的乱象？
